
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title> | 天机工程</title>
    <meta name="author" content="bigbigbigwaterbucket" />
    <meta name="description" content="科技不是一题一解的死板学识，而是令我们超凡脱俗的产物。" />
    <meta name="keywords" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <link rel="icon" href="/images/avatar.jpg" />
    <link rel="preconnect" href="https://cdn.staticfile.org" />
<script src="https://cdn.staticfile.org/vue/3.3.4/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.4.0/css/all.min.css" />
<link rel="preconnect" href="https://fonts.loli.net" />
<link rel="preconnect" href="https://gstatic.loli.net" crossorigin />
<link rel="stylesheet" href="https://fonts.loli.net/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap" />
<script> const mixins = {}; </script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>


<script src="https://cdn.staticfile.org/highlight.js/11.8.0/highlight.min.js"></script>
<script src="https://cdn.staticfile.org/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://cdn.staticfile.org/highlight.js/11.8.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>



<script src="/js/lib/preview.js"></script>









<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 6.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>加载过慢请开启缓存 浏览器默认开启</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>天机工程</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
        <a href="/categories">
            <i class="fa-solid fa-bookmark fa-fw"></i>
            <span>&ensp;Categories</span>
        </a>
        
        <a href="/tags">
            <i class="fa-solid fa-tags fa-fw"></i>
            <span>&ensp;Tags</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;天机工程</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
                <a href="/categories">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-bookmark fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Categories</div>
                    </div>
                </a>
                
                <a href="/tags">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-tags fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Tags</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div class="article">
    <div>
        <h1></h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2023/10/22
        </span>
        
        
    </div>
    
    <div class="content" v-pre>
        <h1 id="bit杯-爬取抖音热度榜"><a href="#bit杯-爬取抖音热度榜" class="headerlink" title="bit杯-爬取抖音热度榜"></a>bit杯-爬取抖音热度榜</h1><p>今天写了一天bit杯的爬虫题，完成是完成了，但是写吐了。</p>
<p>接下来几个星期都不想写爬虫了…</p>
<span id="more"></span>

<pre><code>import requests
import datetime
import openpyxl
import matplotlib.pyplot as plt
import threading
import pymysql

&quot;&quot;&quot;
使用说明:
第三方依赖openpyxl、matplotlib、pymysql
数据库参数说明:db_host数据库服务器主机名 db_user数据库用户名 db_password数据库密码 db_port数据库端口 db_name数据库名称
第一、二题默认将excel文件、视频文件(mp4)保存在DY_spider.py文件的同级目录中
&quot;&quot;&quot;

db_host = &#39;localhost&#39;
db_user = &#39;root&#39;
db_password = &#39;757268&#39;
db_port = 3306
db_name = &#39;Mysql&#39;

session1 = requests.session()

headers = &#123;
    &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36 Edg/118.0.2088.57&quot;,
    &quot;Referer&quot;: &quot;https://www.douyin.com/discover&quot;,
&#125;

params1 = &#123;&quot;device_platform&quot;: &quot;webapp&quot;,
           &quot;aid&quot;: &quot;6383&quot;,
           &quot;channel&quot;: &quot;channel_pc_web&quot;,
           &quot;detail_list&quot;: &quot;1&quot;,
           &quot;source&quot;: &quot;6&quot;,
           &quot;board_type&quot;: &quot;0&quot;,
           &quot;pc_client_type&quot;: &quot;1&quot;,
           &quot;version_code&quot;: &quot;170400&quot;,
           &quot;version_name&quot;: &quot;17.4.0&quot;,
           &quot;cookie_enabled&quot;: &quot;true&quot;,
           &quot;screen_width&quot;: &quot;1536&quot;,
           &quot;screen_height&quot;: &quot;864&quot;,
           &quot;browser_language&quot;: &quot;zh-CN&quot;,
           &quot;browser_platform&quot;: &quot;Win32&quot;,
           &quot;browser_name&quot;: &quot;Edge&quot;,
           &quot;browser_version&quot;: &quot;118.0.2088.57&quot;,
           &quot;browser_online&quot;: &quot;true&quot;,
           &quot;engine_name&quot;: &quot;Blink&quot;,
           &quot;engine_version&quot;: &quot;118.0.0.0&quot;,
           &quot;os_name&quot;: &quot;Windows&quot;,
           &quot;os_version&quot;: &quot;10&quot;,
           &quot;cpu_core_num&quot;: &quot;8&quot;,
           &quot;device_memory&quot;: &quot;8&quot;,
           &quot;platform&quot;: &quot;PC&quot;,
           &quot;downlink&quot;: &quot;10&quot;,
           &quot;effective_type&quot;: &quot;4g&quot;,
           &quot;round_trip_time&quot;: &quot;50&quot;,
           &quot;webid&quot;: &quot;7292586728233502227&quot;,
           &quot;msToken&quot;: &quot;Sg1rnezO2VpibJVFdr3XfGX3aYFjKOc_9XUtOFEso7vWMSaOZZpYrg7xm9OtE9EEea4wIeDAJ3VLowvmfFhJgLq05jpPwPqgQi3TLwQM_6XzTMLcCwMhHdb7kcQXiYi9Yw==&quot;,
           &quot;X-Bogus&quot;: &quot;DFSzsdVuFxTANtL4tYdtttteJnx4&quot;
           &#125;

hot = session1.get(&quot;https://www.douyin.com/aweme/v1/web/hot/search/list/&quot;, params=params1, headers=headers)
hot_json = hot.json()
# print(hot_json[&quot;data&quot;][&quot;word_list&quot;])

# 将时间戳 1697869498 转换为 datetime 对象
dt = datetime.datetime.fromtimestamp(1697846660)
# print(dt)

wb = openpyxl.Workbook()
ws = wb.active
ws.title = &quot;DY_spider_info&quot;
ws[&#39;A1&#39;] = &quot;热榜排名&quot;
ws[&#39;B1&#39;] = &quot;热榜标题&quot;
ws[&#39;C1&#39;] = &quot;热榜链接&quot;
ws[&#39;D1&#39;] = &quot;热榜时间&quot;
ws[&#39;E1&#39;] = &quot;热度值&quot;
data_list = []
# data_list有可能没有置顶！！！导致只呈现0-49而不是0-50个
try:
    a = hot_json[&quot;data&quot;][&quot;word_list&quot;][50][&quot;position&quot;]
    for i in range(1, 51):
        data_list.append([hot_json[&quot;data&quot;][&quot;word_list&quot;][i][&quot;position&quot;],
                          hot_json[&quot;data&quot;][&quot;word_list&quot;][i][&quot;word&quot;],
                          &quot;https://www.douyin.com/hot/&quot; + hot_json[&quot;data&quot;][&quot;word_list&quot;][i][&quot;sentence_id&quot;],
                          datetime.datetime.fromtimestamp(hot_json[&quot;data&quot;][&quot;word_list&quot;][i][&quot;event_time&quot;]),
                          hot_json[&quot;data&quot;][&quot;word_list&quot;][i][&quot;hot_value&quot;],
                          ])
except IndexError:
    for i in range(0, 50):
        data_list.append([hot_json[&quot;data&quot;][&quot;word_list&quot;][i][&quot;position&quot;],
                          hot_json[&quot;data&quot;][&quot;word_list&quot;][i][&quot;word&quot;],
                          &quot;https://www.douyin.com/hot/&quot; + hot_json[&quot;data&quot;][&quot;word_list&quot;][i][&quot;sentence_id&quot;],
                          datetime.datetime.fromtimestamp(hot_json[&quot;data&quot;][&quot;word_list&quot;][i][&quot;event_time&quot;]),
                          hot_json[&quot;data&quot;][&quot;word_list&quot;][i][&quot;hot_value&quot;],
                          ])

for each in data_list:
    ws.append(each)
wb.save(&quot;DY_spider_info.xlsx&quot;)


def save_to_mysql():
    db = pymysql.connect(host=db_host, user=db_user, password=db_password, port=db_port, db=db_name,
                         cursorclass=pymysql.cursors.Cursor)
    cursor = db.cursor()
    cursor.execute(&quot;DROP TABLE IF EXISTS DY_spider_info&quot;)
    sql = &quot;&quot;&quot;CREATE TABLE DY_spider_info (
             热榜排名  INT,
             热榜标题  CHAR(50),
             热榜链接  CHAR(50),
             热榜时间  CHAR(50),  
             热度值  INT)
             &quot;&quot;&quot;
    cursor.execute(sql)

    for each in data_list:
        sql = &quot;&quot;&quot;
            INSERT INTO DY_spider_info(热榜排名, 热榜标题, 热榜链接, 热榜时间, 热度值)
            VALUES (%s, %s, %s, %s, %s)
        &quot;&quot;&quot;
        cursor.execute(sql, (each[0], each[1], each[2], each[3], each[4]))

    sql = &quot;SELECT * FROM DY_spider_info&quot;
    cursor.execute(sql)
    results = cursor.fetchall()
    for row in results:
        paiming = row[0]
        biaoti = row[1]
        lianjie = row[2]
        time = row[3]
        redu = row[4]
        print(&quot;排名：%s,标题：%s,链接：%s,时间：%s,热度值：%s&quot; % (paiming, biaoti, lianjie, time, redu))


save_to_mysql()

tag_ids = &#123;
    &quot;Knowledge&quot;: &quot;https://www.douyin.com/aweme/v1/web/channel/feed/?device_platform=webapp&amp;aid=6383&amp;channel=channel_pc_web&amp;count=16&amp;tag_id=300213&amp;Seo-Flag=0&amp;refresh_index=1&amp;awemePcRecRawData=%7B%22is_client%22:false%7D&amp;pc_client_type=1&amp;version_code=170400&amp;version_name=17.4.0&amp;cookie_enabled=true&amp;screen_width=1536&amp;screen_height=864&amp;browser_language=zh-CN&amp;browser_platform=Win32&amp;browser_name=Edge&amp;browser_version=118.0.2088.57&amp;browser_online=true&amp;engine_name=Blink&amp;engine_version=118.0.0.0&amp;os_name=Windows&amp;os_version=10&amp;cpu_core_num=8&amp;device_memory=8&amp;platform=PC&amp;downlink=10&amp;effective_type=4g&amp;round_trip_time=50&amp;webid=7292586728233502227&amp;msToken=bqKtGt8xkq2FGgQqhOCHU-dwKGI49__WpO62in3slKgX66KChJVqmRST1H4JrSB1sJluUDNO0QSqJjpc7oW7HqfsArKnnwaCi7jFi7xBlGT0jlpM1bGSBwW91Ej9xla1iw==&amp;X-Bogus=DFSzsdVOzKTANJbetYDwJtteJn9t&quot;,
    &quot;Game&quot;: &quot;https://www.douyin.com/aweme/v1/web/channel/feed/?device_platform=webapp&amp;aid=6383&amp;channel=channel_pc_web&amp;tag_id=300205&amp;count=10&amp;Seo-Flag=0&amp;refresh_index=1&amp;pc_client_type=1&amp;version_code=170400&amp;version_name=17.4.0&amp;cookie_enabled=true&amp;screen_width=1536&amp;screen_height=864&amp;browser_language=zh-CN&amp;browser_platform=Win32&amp;browser_name=Edge&amp;browser_version=118.0.2088.57&amp;browser_online=true&amp;engine_name=Blink&amp;engine_version=118.0.0.0&amp;os_name=Windows&amp;os_version=10&amp;cpu_core_num=8&amp;device_memory=8&amp;platform=PC&amp;downlink=10&amp;effective_type=4g&amp;round_trip_time=50&amp;webid=7292586728233502227&amp;msToken=ZECxHUrsM-8pCzB2W415MWusfPvkmNtTcRR3isvW5guIops9GaYK49u19tMFJxPvQvdVM5ZoiTnQoFDITgYYqogUaGiCav3zYFOBwg2wfW0DhtqLnc9vZG70XbuhkWLjP-w=&amp;X-Bogus=DFSzsdVuInXANtL4tYDz2tteJnHU&quot;,
    &quot;Entertainment&quot;: &quot;https://www.douyin.com/aweme/v1/web/channel/feed/?device_platform=webapp&amp;aid=6383&amp;channel=channel_pc_web&amp;tag_id=300201&amp;count=10&amp;Seo-Flag=0&amp;refresh_index=1&amp;pc_client_type=1&amp;version_code=170400&amp;version_name=17.4.0&amp;cookie_enabled=true&amp;screen_width=1536&amp;screen_height=864&amp;browser_language=zh-CN&amp;browser_platform=Win32&amp;browser_name=Edge&amp;browser_version=118.0.2088.57&amp;browser_online=true&amp;engine_name=Blink&amp;engine_version=118.0.0.0&amp;os_name=Windows&amp;os_version=10&amp;cpu_core_num=8&amp;device_memory=8&amp;platform=PC&amp;downlink=10&amp;effective_type=4g&amp;round_trip_time=50&amp;webid=7292586728233502227&amp;msToken=1iK6-9745aVAORvR7XOl0MlCfNMmQjq728vlBXcOcltMAZx8ZLepU_E4jFmpa2qw2QNBrJkRXbheSwwXlkh6uwwJAgh4-rNmlI-KcmkKJsD7JApjV-_4CmRjCnTV61TpnvU=&amp;X-Bogus=DFSzsdVOz6xANJbetYDn/zteJn9o&quot;,
    &quot;Two-dimensional&quot;: &quot;https://www.douyin.com/aweme/v1/web/channel/feed/?device_platform=webapp&amp;aid=6383&amp;channel=channel_pc_web&amp;tag_id=300206&amp;count=10&amp;Seo-Flag=0&amp;refresh_index=1&amp;pc_client_type=1&amp;version_code=170400&amp;version_name=17.4.0&amp;cookie_enabled=true&amp;screen_width=1536&amp;screen_height=864&amp;browser_language=zh-CN&amp;browser_platform=Win32&amp;browser_name=Edge&amp;browser_version=118.0.2088.57&amp;browser_online=true&amp;engine_name=Blink&amp;engine_version=118.0.0.0&amp;os_name=Windows&amp;os_version=10&amp;cpu_core_num=8&amp;device_memory=8&amp;platform=PC&amp;downlink=10&amp;effective_type=4g&amp;round_trip_time=50&amp;webid=7292586728233502227&amp;msToken=k7GBkOEHoe6BRbzpGSHXhsAOddKPuQPl9XREWOAdIznEqSA1Q8rqk_KbhBhpNp-Ct2-PUPVmkzcmK6Vo4M5qXvuTlVOFXwEdGwpH7XeuycvIhwxFAzAZC5uunGc41EFtwJE=&amp;X-Bogus=DFSzsdVu-pGANtL4tYDSjzteJnxh&quot;,
    &quot;Music&quot;: &quot;https://www.douyin.com/aweme/v1/web/channel/feed/?device_platform=webapp&amp;aid=6383&amp;channel=channel_pc_web&amp;tag_id=300209&amp;count=10&amp;Seo-Flag=0&amp;refresh_index=1&amp;pc_client_type=1&amp;version_code=170400&amp;version_name=17.4.0&amp;cookie_enabled=true&amp;screen_width=1536&amp;screen_height=864&amp;browser_language=zh-CN&amp;browser_platform=Win32&amp;browser_name=Edge&amp;browser_version=118.0.2088.57&amp;browser_online=true&amp;engine_name=Blink&amp;engine_version=118.0.0.0&amp;os_name=Windows&amp;os_version=10&amp;cpu_core_num=8&amp;device_memory=8&amp;platform=PC&amp;downlink=10&amp;effective_type=4g&amp;round_trip_time=50&amp;webid=7292586728233502227&amp;msToken=J8JDBQ9KhflivKOFrNUjzroORhXGxF4ws0zOratk4Yemqm5fFZ8wbSTTZwKYz9Wo_LMyagNt-eVLrBe8lICrw-d9lgH6ZgmX5c9h9rieKzcmdetcsYml8KVqGmCGGA30y3I=&amp;X-Bogus=DFSzsdVuWzvANtL4tYDSFzteJnH0&quot;,
    &quot;Food&quot;: &quot;https://www.douyin.com/aweme/v1/web/channel/feed/?device_platform=webapp&amp;aid=6383&amp;channel=channel_pc_web&amp;tag_id=300204&amp;count=10&amp;Seo-Flag=0&amp;refresh_index=1&amp;pc_client_type=1&amp;version_code=170400&amp;version_name=17.4.0&amp;cookie_enabled=true&amp;screen_width=1536&amp;screen_height=864&amp;browser_language=zh-CN&amp;browser_platform=Win32&amp;browser_name=Edge&amp;browser_version=118.0.2088.57&amp;browser_online=true&amp;engine_name=Blink&amp;engine_version=118.0.0.0&amp;os_name=Windows&amp;os_version=10&amp;cpu_core_num=8&amp;device_memory=8&amp;platform=PC&amp;downlink=10&amp;effective_type=4g&amp;round_trip_time=50&amp;webid=7292586728233502227&amp;msToken=J8JDBQ9KhflivKOFrNUjzroORhXGxF4ws0zOratk4Yemqm5fFZ8wbSTTZwKYz9Wo_LMyagNt-eVLrBe8lICrw-d9lgH6ZgmX5c9h9rieKzcmdetcsYml8KVqGmCGGA30y3I=&amp;X-Bogus=DFSzsdVuiPzANtL4tYDSitteJnxF&quot;,
    &quot;Sport&quot;: &quot;https://www.douyin.com/aweme/v1/web/channel/feed/?device_platform=webapp&amp;aid=6383&amp;channel=channel_pc_web&amp;tag_id=300207&amp;count=10&amp;Seo-Flag=0&amp;refresh_index=1&amp;pc_client_type=1&amp;version_code=170400&amp;version_name=17.4.0&amp;cookie_enabled=true&amp;screen_width=1536&amp;screen_height=864&amp;browser_language=zh-CN&amp;browser_platform=Win32&amp;browser_name=Edge&amp;browser_version=118.0.2088.57&amp;browser_online=true&amp;engine_name=Blink&amp;engine_version=118.0.0.0&amp;os_name=Windows&amp;os_version=10&amp;cpu_core_num=8&amp;device_memory=8&amp;platform=PC&amp;downlink=10&amp;effective_type=4g&amp;round_trip_time=50&amp;webid=7292586728233502227&amp;msToken=J8JDBQ9KhflivKOFrNUjzroORhXGxF4ws0zOratk4Yemqm5fFZ8wbSTTZwKYz9Wo_LMyagNt-eVLrBe8lICrw-d9lgH6ZgmX5c9h9rieKzcmdetcsYml8KVqGmCGGA30y3I=&amp;X-Bogus=DFSzsdVuNTUANtL4tYDSLUteJnxU&quot;,
    &quot;Fashion&quot;: &quot;https://www.douyin.com/aweme/v1/web/channel/feed/?device_platform=webapp&amp;aid=6383&amp;channel=channel_pc_web&amp;tag_id=300208&amp;count=10&amp;Seo-Flag=0&amp;refresh_index=1&amp;pc_client_type=1&amp;version_code=170400&amp;version_name=17.4.0&amp;cookie_enabled=true&amp;screen_width=1536&amp;screen_height=864&amp;browser_language=zh-CN&amp;browser_platform=Win32&amp;browser_name=Edge&amp;browser_version=118.0.2088.57&amp;browser_online=true&amp;engine_name=Blink&amp;engine_version=118.0.0.0&amp;os_name=Windows&amp;os_version=10&amp;cpu_core_num=8&amp;device_memory=8&amp;platform=PC&amp;downlink=10&amp;effective_type=4g&amp;round_trip_time=50&amp;webid=7292586728233502227&amp;msToken=J8JDBQ9KhflivKOFrNUjzroORhXGxF4ws0zOratk4Yemqm5fFZ8wbSTTZwKYz9Wo_LMyagNt-eVLrBe8lICrw-d9lgH6ZgmX5c9h9rieKzcmdetcsYml8KVqGmCGGA30y3I=&amp;X-Bogus=DFSzsdVuQekANtL4tYDtAUteJnx9&quot;
&#125;

headers2 = &#123;
    &quot;Accept&quot;: &quot;application/json, text/plain, */*&quot;,
    &quot;Accept-Encoding&quot;: &quot;gzip&quot;,
    &quot;Accept-Language&quot;: &quot;zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6&quot;,
    &quot;Cookie&quot;: &quot;ttwid=1%7Ci2fGDGXdsdlq-AYCufRuIChCwOHFJZyFNzDqV5t46s4%7C1697937678%7Cd20ad716c77f963cf8f62221de28730833027ecafebb31ca730f45cb743563a0; douyin.com; device_web_cpu_core=8; device_web_memory_size=8; architecture=amd64; webcast_local_quality=null; passport_csrf_token=8ce2fc5c3aa393b86a30971d2473ac15; passport_csrf_token_default=8ce2fc5c3aa393b86a30971d2473ac15; strategyABtestKey=%221697937681.37%22; s_v_web_id=verify_lo0s9885_TMVkcvah_KxyI_4uKX_Bww5_6O4wSMTBhFqf; volume_info=%7B%22isUserMute%22%3Afalse%2C%22isMute%22%3Afalse%2C%22volume%22%3A0.6%7D; xgplayer_user_id=610983813274; odin_tt=08c00f74c96d9205776b45b204a7f613588375aceaa88c5799802a8bbc81f4942fbd64b4a2bbad340e0275af01e3c521a8f5b26828a9597b177b6c67f1fdc1137d23e5ffabb6e3af8ff5c7f166f60d84; csrf_session_id=f37f074d96e3fd5322b0fdbdcae0c267; my_rd=2; FORCE_LOGIN=%7B%22videoConsumedRemainSeconds%22%3A180%2C%22isForcePopClose%22%3A1%7D; download_guide=%223%2F20231022%2F0%22; pwa2=%220%7C0%7C3%7C0%22; VIDEO_FILTER_MEMO_SELECT=%7B%22expireTime%22%3A1698548471397%2C%22type%22%3A1%7D; tt_scid=tl85-fOQNT3S5zZkxyg9BYKd8vchqJdKOA13ThYCW25t9v6Z-qVZGalohQ0gH87X5332; msToken=FZND1BdvqiifujGRTIdsR-6mXI-yJ8KdvmT24cNJHNA_oPkaJ9VUz6oONHSW7K-WwRjdt8byaVy-D1_HMkbbskN5mHozCH2ptl2N4kUd5LlXcfdraLzf6pOIGMmzhOKSRw==; __ac_nonce=06534c07600e372186904; __ac_signature=_02B4Z6wo00f01SBSahAAAIDBK97UVIa8YQUgdm6AAC0jLishCx7etjEPvNfvJNaM0UX3uWFx0rRx6.5K0hX3IyNIKMfJDcEbikWbY-NWLyRmFp7pjmUGkGxpPJQQ9Kc39G-k.0oYmB2eXsmE46; bd_ticket_guard_client_data=eyJiZC10aWNrZXQtZ3VhcmQtdmVyc2lvbiI6MiwiYmQtdGlja2V0LWd1YXJkLWl0ZXJhdGlvbi12ZXJzaW9uIjoxLCJiZC10aWNrZXQtZ3VhcmQtcmVlLXB1YmxpYy1rZXkiOiJCTmtkWjZiMG9JTDl4elNFWGlTUGk4b2FSVy96Mkd6UW9ld0Z2SXFIRTAxSG5pazZndGxPcUhFRlZTMldOZjBWeUN2Q1JrTGE0OXhQcUYrUFo0eE44L2s9IiwiYmQtdGlja2V0LWd1YXJkLXdlYi12ZXJzaW9uIjoxfQ%3D%3D; msToken=f7Uv2WorGfJPVzotcIQUc-oj2Yv4OBv0qBex-XaRG5bVPQKRQDGwDxjAq_z0P4Dj68nk5YhuYJDciNlzInwb7cCCzSKRSxiNwVXBlzFvH6sZWrPIRNi-lJ5PS7abujwh-Q==; IsDouyinActive=true; stream_recommend_feed_params=%22%7B%5C%22cookie_enabled%5C%22%3Atrue%2C%5C%22screen_width%5C%22%3A1536%2C%5C%22screen_height%5C%22%3A864%2C%5C%22browser_online%5C%22%3Atrue%2C%5C%22cpu_core_num%5C%22%3A8%2C%5C%22device_memory%5C%22%3A8%2C%5C%22downlink%5C%22%3A3.75%2C%5C%22effective_type%5C%22%3A%5C%224g%5C%22%2C%5C%22round_trip_time%5C%22%3A100%7D%22; home_can_add_dy_2_desktop=%221%22&quot;,
    &quot;Referer&quot;: &quot;https://www.douyin.com/channel/300203&quot;,
    &quot;Sec-Ch-Ua-Mobile&quot;: &quot;?0&quot;,
    &quot;Sec-Fetch-Dest&quot;: &quot;empty&quot;,
    &quot;Sec-Fetch-Mode&quot;: &quot;cors&quot;,
    &quot;Sec-Fetch-Site&quot;: &quot;same-origin&quot;,
    &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36 Edg/118.0.2088.57&quot;,
&#125;

session2 = requests.session()


def video_spider(tag):
    session2 = requests.session()
    id_json = session2.get(tag_ids[tag], headers=headers2)
    json = id_json.json()
    video_url = json[&quot;aweme_list&quot;][0][&quot;video&quot;][&quot;download_addr&quot;][&quot;url_list&quot;][0]
    video_tag = session2.get(video_url)
    with open(&quot;video_&#123;&#125;.mp4&quot;.format(tag), &quot;wb+&quot;) as f:
        for chunk in video_tag.iter_content(chunk_size=1048576 * 5):  # 每次写入5MB
            if chunk:
                f.write(chunk)


threads = []
for e, (tag, tag_url) in enumerate(tag_ids.items()):
    if e &gt;= 3:
        break
    t = threading.Thread(target=video_spider, args=(tag,))
    t.name = tag
    threads.append(t)
    t.start()
    print(&quot;&#123;&#125;视频写入线程开始&quot;.format(t.name))


# happy = session2.get(
#     &quot;https://www.douyin.com/aweme/v1/web/channel/feed/?device_platform=webapp&amp;aid=6383&amp;channel=channel_pc_web&amp;tag_id=300201&amp;count=10&amp;Seo-Flag=0&amp;refresh_index=1&amp;pc_client_type=1&amp;version_code=170400&amp;version_name=17.4.0&amp;cookie_enabled=true&amp;screen_width=1536&amp;screen_height=864&amp;browser_language=zh-CN&amp;browser_platform=Win32&amp;browser_name=Edge&amp;browser_version=118.0.2088.57&amp;browser_online=true&amp;engine_name=Blink&amp;engine_version=118.0.0.0&amp;os_name=Windows&amp;os_version=10&amp;cpu_core_num=8&amp;device_memory=8&amp;platform=PC&amp;downlink=3.75&amp;effective_type=4g&amp;round_trip_time=100&amp;webid=7292586728233502227&amp;msToken=FZND1BdvqiifujGRTIdsR-6mXI-yJ8KdvmT24cNJHNA_oPkaJ9VUz6oONHSW7K-WwRjdt8byaVy-D1_HMkbbskN5mHozCH2ptl2N4kUd5LlXcfdraLzf6pOIGMmzhOKSRw==&amp;X-Bogus=DFSzsdVOrnxANJbetYDgxUteJnxb&quot;,
#     headers=headers2)

# 娱乐频道参数&quot;tag_id&quot;: &quot;300201&quot; tag_id区分不同频道
# happy_json = happy.json()
# print(happy_json)
# video_url = happy_json[&quot;aweme_list&quot;][0][&quot;video&quot;][&quot;download_addr&quot;][&quot;url_list&quot;][0]
# video_happy = session2.get(video_url)

# with open(&quot;video_娱乐.mp4&quot;, &quot;wb+&quot;) as f:
#     for chunk in video_happy.iter_content(chunk_size=1024):
#         if chunk:
#             f.write(chunk)


# game = session2.get(
#     &quot;https://www.douyin.com/aweme/v1/web/channel/feed/?device_platform=webapp&amp;aid=6383&amp;channel=channel_pc_web&amp;tag_id=300205&amp;count=10&amp;Seo-Flag=0&amp;refresh_index=1&amp;pc_client_type=1&amp;version_code=170400&amp;version_name=17.4.0&amp;cookie_enabled=true&amp;screen_width=1536&amp;screen_height=864&amp;browser_language=zh-CN&amp;browser_platform=Win32&amp;browser_name=Edge&amp;browser_version=118.0.2088.57&amp;browser_online=true&amp;engine_name=Blink&amp;engine_version=118.0.0.0&amp;os_name=Windows&amp;os_version=10&amp;cpu_core_num=8&amp;device_memory=8&amp;platform=PC&amp;downlink=3.75&amp;effective_type=4g&amp;round_trip_time=100&amp;webid=7292586728233502227&amp;msToken=7sN84iKHfdDIPITZwX7fdY82fPSxr328d1ZKGQLHEa6ej7OAZBFfRCJP-swkXMuzc0v7SM4M-haQ7JYA4f7deY4-r8MPGlZvxaXlzHpoZ7wAOLm9nZx2Fwvu2ekOFlw6g-0=&amp;X-Bogus=DFSzsdVOzKTANJbetYDwJtteJn9t&quot;,
#     headers=headers2)
#
# game_json = game.json()
# # print(game_json)
# video_url = game_json[&quot;aweme_list&quot;][0][&quot;video&quot;][&quot;download_addr&quot;][&quot;url_list&quot;][0]
# video_game = session2.get(video_url)

# with open(&quot;video_游戏.mp4&quot;, &quot;wb+&quot;) as f:
#     for chunk in video_game.iter_content(chunk_size=1024):
#         if chunk:
#             f.write(chunk)


def digg_count(tag_url):
    id_json = requests.get(tag_url, headers=headers2)
    count = 0
    i = 0
    json = id_json.json()
    try:
        for i in range(0, 10):
            count += json[&quot;aweme_list&quot;][i][&quot;statistics&quot;][&quot;digg_count&quot;]
    except IndexError:
        o = i
        id_json = requests.get(tag_url, headers=headers2)
        json = id_json.json()
        while (i &lt; 9):
            count += json[&quot;aweme_list&quot;][i - o][&quot;statistics&quot;][&quot;digg_count&quot;]
            i = i + 1
    return count


def plot3():
    x_label = []
    y = []
    for tag, tag_url in tag_ids.items():
        _count = digg_count(tag_url)
        x_label.append(tag)
        y.append(_count)
        print(&quot;分区:&#123;&#125;,视频点赞数总和:&#123;&#125;&quot;.format(tag, _count))

    x = [1, 2, 3, 4, 5, 6, 7, 8]
    color = [&#39;red&#39;, &#39;peru&#39;, &#39;orchid&#39;, &#39;deepskyblue&#39;]
    plt.figure(figsize=(20, 12))
    plt.xticks(x, x_label)
    plt.yticks(y)
    plt.bar(x, y, color=color)
    plt.grid(True, linestyle=&#39;:&#39;, color=&#39;r&#39;)
    plt.title(&quot;Likes for 9 videos&quot;)
    plt.show()


plot3()
for t in threads:
    print(&quot;等待&#123;&#125;线程结束&quot;.format(t.name))
    t.join()
    print(&quot;&#123;&#125;线程结束&quot;.format(t.name))
</code></pre>

    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 天机工程
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;bigbigbigwaterbucket
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    
<script
    src="https://giscus.app/client.js"
    data-repo="bigbigbigwaterbucket/bigbigbigwaterbucket.github.io"
    data-repo-id="R_kgDOKFcnSw"
    data-category="Announcements"
    data-category-id="DIC_kwDOKFcnS84CaIBo"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="https://static-argvchs.netlify.app/css/giscus.css"
    data-lang="zh-CN"
    crossorigin
    async
></script>





    
</body>
</html>
